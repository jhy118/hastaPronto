<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.announcement.annMapper">
   <sql id="announcement">
      ANN_NO, ANN_SUBJECT, ANN_DATE, ANN_CONTENT, EMP_ID, 
      READ_COUNT, ANN_STOREDFILENAME, ANN_ORIGINALFILENAME, ANN_FILESIZE
   </sql>
   <insert id="insertAnn" parameterType="ann">
      insert into ANNOUNCEMENT (<include refid="announcement" />)
      values(board_seq.nextval, #{annSubject}, SYSDATE, #{annContent},
      #{empId}, 0, 
      <if test="annOriginalFileName != ''">
      		#{annStoredFileName}, 
      		#{annOriginalFileName}, 
      		#{annFileSize}
      </if>
      <if test="annOriginalFileName == ''">
      		null, null, null
      </if>
      )
   </insert>
   <resultMap type="ann" id="annResult">
   		<id column="ANN_NO" jdbcType="VARCHAR" property="annNo"/>
   		<result column="ANN_SUBJECT" jdbcType="VARCHAR" property="annSubject" />
   		<result column="ANN_DATE" jdbcType="TIMESTAMP" property="annDate" />
   		<result column="ANN_CONTENT" jdbcType="VARCHAR" property="annContent" />
   		<result column="EMP_ID" jdbcType="VARCHAR" property="empId" />
   		<result column="READ_COUNT" jdbcType="BIGINT" property="readCount" />
   		<result column="ANN_STOREDFILENAME" jdbcType="VARCHAR" property="annStoredFileName" />
   		<result column="ANN_ORIGINALFILENAME" jdbcType="VARCHAR" property="annOriginalFileName" />
   		<result column="ANN_FILESIZE" jdbcType="VARCHAR" property="annFileSize" />
   </resultMap>
   <select id="getCount" resultType="int">
   		select count(*) from ANNOUNCEMENT
   </select>
   <select id="getAnnList" parameterType="ann" resultMap="annResult">
   		select *
   		from ( select rownum rn, <include refid="announcement" />
   			from (select <include refid="announcement" />
   					from ANNOUNCEMENT
   					<where>
   						<if test="annNo != null">
   							ANN_NO = #{annNo}
   						</if>
   					</where>
   				)
   			)
   		<if test="startEndPageDTO != null">
   		where rn between #{startEndPageDTO.startRow}
   			and #{startEndPageDTO.endRow}
   		</if>
   </select>
   <update id="updateAnn" parameterType="ann">
         update ANNOUNCEMENT
         set ANN_SUBJECT = #{annSubject}, 
         	 ANN_CONTENT = #{annContent},
         	 ANN_STOREDFILENAME = #{annStoredFileName},
         	 ANN_ORIGINALFILENAME = #{annOriginalFileName},
         	 ANN_FILESIZE = #{annFileSize}
         where EMP_ID = #{empId} and ANN_NO = #{annNo}
   </update>
   <delete id="deleteAnn" parameterType="string">
         delete from ANNOUNCEMENT
         where ann_no = #{value}
   </delete>
   <update id="updateReadCount" parameterType="string">
   		update ANNOUNCEMENT
   		set READ_COUNT = READ_COUNT+1
   		where ann_no = #{value}
   </update>
</mapper>